(()=>{var m;try{m=localStorage.getItem("BEAT_LOG")}catch(t){}function s(...t){(document.location.hostname==="localhost"||m)&&console.log(...t)}function u(t){return t.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}function d(t){let e=/\.([0-9a-z]+)(?=[?#])|(\.)(?:[\w]+)$/gim,r=t.match(e);if(!r)return;let o=r[0].replace(".","");if(Number(o).toString()!==o)return o}async function g(t,e={}){return s("post",t,e),(await fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})).json()}function p(t,e,r){let o,n;function i(){n&&clearTimeout(n),n=o=void 0}function c(){i(),o=Date.now(),n=setTimeout(()=>{r(),i()},e)}return()=>{(!o||Date.now()-o<t)&&c()}}function h(t,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let r="";for(var o=0;o<t;o++){let n=Math.floor(Math.random()*e.length);r+=e.substring(n,n+1)}return r}function w(){return window.location.href.toString()}function v(){let t=window.performance.memory;return{memory_heap_limit:t?t.jsHeapSizeLimit:void 0,memory_heap_total:t?t.totalJSHeapSize:void 0,memory_heap_used:t?t.usedJSHeapSize:void 0}}function y(){let t=performance.getEntriesByType("resource"),e={},r=["duration","encodedBodySize","decodedBodySize"];for(let o of t){e.resource_count=e.resource_count||0+1;for(let n of r){let i=`resource_${u(n)}_total`;if(e[i]=e[i]||0+o[n],d(o.name)&&o[n]){let a=`resource_${u(n)}_${d(o.name)}`;e[a]=e[a]||Math.round(0+o[n])}}}return e}function x(){return window.performance.timing.domContentLoadedEventEnd-window.performance.timing.navigationStart}function S(){let t=window.navigator.userAgent,e=window.navigator.platform,r=["Macintosh","MacIntel","MacPPC","Mac68K"],o=["Win32","Win64","Windows","WinCE"],n=["iPhone","iPad","iPod"],i="other";return r.indexOf(e)!==-1?i="macos":n.indexOf(e)!==-1?i="ios":o.indexOf(e)!==-1?i="windows":/Android/.test(t)?i="android":!i&&/Linux/.test(e)&&(i="linux"),i}function k(){let t=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(t)?"mobile":"desktop"}function b(){let t=e=>e.test(window.navigator.userAgent);return t(/edg/i)?"edge":t(/trident/i)?"msie":t(/chrome|chromium|crios/i)?"chrome":t(/safari/i)?"safari":"firefox"}function l(t){try{return JSON.parse(window.localStorage.getItem(t))}catch(e){return}}function _(t,e){window.localStorage.setItem(t,JSON.stringify(e))}function P(t){window.localStorage.removeItem(t)}var f=class{constructor(e,r,o=""){this.context={};this.schedule=p(300,3e3,()=>{this.flush()});this.flush=async()=>{s("flush",this.key);let e=l(this.key);if(s("current",e),!e)return;P(this.key);let r=e.map(n=>{let[i,c]=n,a={source:this.source,url:w(),cookie:O(),user_id:this.userId};return{event:i,context:a,data:c}}),o=await g(this.url,r);s(o)};this.scope=e,this.source=r,this.url=o,window&&E(this)}record(e,r={}){r={...r,...this.context},s("record",e,r);let o=l(this.key);_(this.key,Array.isArray(o)?[[e,r],...o]:[[e,r]]),this.schedule()}get key(){return this.scope}setContext(e){this.context={...e,...this.context}}setUserId(e){this.userId=e}};function E(t){t.setContext({os:S(),device:k(),browser:b(),ua:navigator.userAgent}),T(t),A(t)}function T(t){s("setupPageLoadEvent",document.readyState);let e=()=>{s("recordPageLoadEvent"),t.record("page_load",{referrer:document.referrer,duration:x(),...y()})};document.readyState==="complete"?e():window.addEventListener("load",e)}function A(t,e=60){let r=L(10*1e3),o=C(),n=1,i=0,c=0;setInterval(()=>{r()&&(i+=n)},n*1e3),setInterval(()=>{t.record("heartbeat",{document_hidden:document.hidden,document_foreground:o(),document_element_count:document.getElementsByTagName("*").length,user_active_seconds:i-c,user_active_total_seconds:i,...v()}),c=i},e*1e3)}var D=(t,e,r=7,o="/")=>{let n=new Date(Date.now()+r*864e5).toUTCString(),i=encodeURIComponent(e);document.cookie=`${t}=${i}; expires=${n}; path=${o}`},I=t=>document.cookie.split("; ").reduce((e,r)=>{let[o,n]=r.split("=");return o===t?decodeURIComponent(n):e},"");function L(t=1e3*10){let e=!1,r,o=()=>{e||(s("active: true"),e=!0,clearTimeout(r),r=setTimeout(n,t))},n=()=>{!e||(s("active: false"),e=!1)},i=["mousemove","mousedown","keydown","touchstart","scroll"];for(let c of i)document.addEventListener(c,o);return function(){return e}}function C(){let t=!document.hidden;return window.addEventListener("focus",()=>{t=!0}),window.addEventListener("blur",()=>{t=!1}),function(){return t}}function O(){let t="pulse",e=I(t);return e||(e=h(32),D(t,e)),e}window&&(window.Pulse=(t,e)=>new f(t,e,`https://beat.dev/${t}`));})();
